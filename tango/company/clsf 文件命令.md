# CYCLE
### 一、 CYCLE 命令的基本结构

APT 语言中的命令结构是：**`主要命令/描述性数据`**

对于 `CYCLE` 命令，其通用格式为：

$$\text{CYCLE}/\text{[循环类型]}, [\text{子类型}], [\text{运动参数}], [\text{工艺参数}] \ldots$$

- **`CYCLE`**: 主要命令，表明接下来的动作是一个固定循环。
- **`[循环类型]`**: 确定要执行的循环种类（例如：钻孔、攻丝、镗孔）。
- **`[子类型]`**: 可选，用于进一步定义循环的变体（例如：带停留的镗孔、啄食式钻孔）。
- **`[运动/工艺参数]`**: 定义循环的几何和加工特性（例如：安全平面、深度、进给率、停留时间）。
    

### 二、 核心参数的详细解释

APT/CLSF 中的 `CYCLE` 命令通过一系列关键字（通常是**模态**，即设置后对后续所有 `GOTO` 命令都有效，直到被新 `CYCLE` 命令覆盖或用 `CYCLE/OFF` 取消）来定义循环的运动特征。

| **参数关键字 (Keyword)** | **传统 APT**         | **常见 CLSF 变体**                                                | **数据类型**                 | **功能描述**                                                                                                                                                                    |
| ------------------- | ------------------ | ------------------------------------------------------------- | ------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **$\text{RAPTO}$**  | $\text{RAPTO}, a$  | -                                                             | 增量距离 $a$                 | **快速定位平面。** $Z$ 轴上快速移动到此平面，然后 $X, Y$ 移动到下一个孔位。$a$ 是从 $CL$ 点（或工件表面）开始的增量距离。                                                                                                  |
| **$\text{CLEAR}$**  | -                  | $\text{CLEAR}, a$                                             | 增量距离 $a$                 | **安全/清除平面。** 功能与 $\text{RAPTO}$ 类似，是现代 CLSF 中更常用的关键字。                                                                                                                       |
| **$\text{FEDTO}$**  | $\text{FEDTO}, b$  | $\text{FEDTO}, b$                                             | 增量距离 $b$                 | **进给起始平面。** $Z$ 轴快速移动到此平面，然后开始进给切削。$b$ 是从 $CL$ 点开始的增量距离。                                                                                                                    |
| **$\text{DEPTH}$**  | $\text{DEPTH}, d$  | $\text{DEPTH}, d$                                             | 增量距离 $d$                 | **最终切削深度。** 从 $\text{FEDTO}$ 平面开始计算的深度。$d$ 通常是一个负值。                                                                                                                         |
| **$\text{RTRCTO}$** | $\text{RTRCTO}, c$ | $\text{RTRCTO}, c$ / $\text{RTRCTO}, \text{AUTO}$             | 增量距离 $c$ 或 $\text{AUTO}$ | **退刀平面。** 定义循环完成后 $Z$ 轴退回到的平面。$\text{AUTO}$ 通常指 $\text{CLEAR}$ 平面。                                                                                                          |
| **$\text{DWELL}$**  | $\text{DWELL}, t$  | $\text{DWELL}$<br>$\text{DWELL}, t$<br>$\text{DWELL, REV}, t$ | 时间 $t$                   | **停留时间。** 在孔底停留的时间（通常是秒或毫秒），如果没有 t 参数代表使用机床内部的默认时间。用于精镗孔。<br>**反转停留（Reverse Dwell）**。是一个高级功能，表示在循环结束退刀前：1. 主轴停止；2. **主轴反向旋转（REV）**；3. **停留 $2.0000$ 秒**。这个操作通常用于在孔底倒角或清除切屑。 |
| $\text{STEP}$       | $\text{STEP}, d$   |                                                               |                          | 刀具在每次进给中切削的最大深度。                                                                                                                                                            |
| **$\text{FEDRAT}$** | $\text{FEDRAT}, f$ | $\dots, \text{MMPM}, f$                                       | 速率 $f$                   | **进给速率。** 定义切削时的进给速度。在 $\text{CLSF}$ 中常与单位关键字一起使用。                                                                                                                          |
| **$\text{MMPM}$**   | -                  | $\text{MMPM}$                                                 | -                        | **进给率单位**（毫米/分钟）。                                                                                                                                                           |
| **$\text{IPM}$**    | -                  | $\text{IPM}$                                                  | -                        | **进给率单位**（英寸/分钟）。                                                                                                                                                           |


### 三、 常见循环类型及其子类型

`CYCLE` 命令可以定义多种孔加工操作。以下是一些关键示例：

#### 1. 简单钻孔（Simple Drilling）

用于生成标准的钻孔循环（类似于 G81）。

$$\text{CYCLE}/\text{DRILL}, \text{RAPTO}, a, \text{DEPTH}, d, \text{FEDRAT}, f$$

**工作序列（由后处理器生成）：**

1. **快速移动**到 $(X, Y)$ 位置， $Z$ 轴停在 `RAPTO` 平面。
    
2. **进给移动**到 $Z$ 轴最终深度（由 `DEPTH` 决定）。
    
3. **快速退回**到 `RTRCTO` 或 `RAPTO` 平面。
    

#### 2. 镗孔（Boring）

镗孔有多种模式，用于控制刀具在孔底的动作和退刀方式：

|**循环子类型**|**APT 命令示例**|**描述**|
|---|---|---|
|**标准镗孔**|$\text{CYCLE}/\text{BORE}, \dots$|进给到深度，然后进给退回到 `RTRCTO` 平面。|
|**带停留镗孔**|$\text{CYCLE}/\text{BORE}, \text{DWELL}, t, \dots$|进给到深度，**停留 $t$ 秒**，然后进给退回。|
|**拖刀镗孔**|$\text{CYCLE}/\text{BORE}, \text{DRAG}, \dots$|进给到深度，**停止主轴**，平移（Shift）刀具避让孔壁，然后快速退回，**恢复主轴**。用于防止在退刀时刮伤孔壁。|

#### 3. 啄食式钻孔（Peck Drilling）

用于深孔，通过分层切削和排屑来钻孔（类似于 G83）。

$$\text{CYCLE}/\text{PECK}, \text{PECK}, p, \text{DEPTH}, d, \dots$$

- **`PECK, p`**: 定义每次切削的深度 $p$（啄食量）。每次进给 $p$ 后都会退出排屑。
    

#### 4. 攻丝（Tapping）

用于在孔内加工螺纹（类似于 G84）。

$$\text{CYCLE}/\text{TAP}, \text{DEPTH}, d, \text{FEDRAT}, f, \dots$$

- **`FEDRAT, f`**: 在攻丝中，进给率 $f$ 必须与螺纹的**螺距**匹配，以确保主轴转速和进给速度同步。
    

### 四、 CYCLE 命令的使用流程

`CYCLE` 命令是 **模态** 的，这意味着它只需要定义一次，就可以应用于一系列孔位。

1. **定义 CYCLE 模式：**
    
    ```
    FEDRAT/ 100.0, MMPM  $$ 设置进给率
    SPINDL/ 2000, CLW     $$ 设置主轴
    CYCLE/ DRILL, RAPTO, 5.0, DEPTH, -15.0, FEDRAT, 100.0
    ```
    
2. **调用孔位（使用 `GOTO`）：**
    
    ```
    GOTO/ P1      $$ 在点 P1 (X, Y) 处执行上述 DRILL 循环
    GOTO/ 50.0, 20.0, 0.0 $$ 在坐标 (50, 20) 处执行相同的 DRILL 循环
    GOTO/ P2      $$ 在点 P2 (X, Y) 处执行相同的 DRILL 循环
    ```
    
3. 取消 CYCLE 模式：
    
    当孔加工序列完成，需要进行轮廓铣削等操作时，必须取消 CYCLE 模式。
    
    ```
    CYCLE/ OFF
    ```
    
    此时，后续的 `GOTO` 命令将回到标准的点对点移动模式。
